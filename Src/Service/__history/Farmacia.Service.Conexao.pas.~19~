unit Farmacia.Service.Conexao;

interface

uses
  FireDAC.Comp.Client,
  IniFiles,
  System.SysUtils,
  Vcl.Forms,
  Farmacia.Model.Connection.Interfaces,
  Farmacia.Model.Connection;

type
  TConexao = class
  private
    FConnecta : iModelConnection;
    FConnect: TFDConnection;
    function GetConnect: TFDConnection;
    procedure GetArquivoCfg;
  public
    property Connect: TFDConnection read GetConnect;
  public
    constructor Create;
    destructor Destroy; override;
  end;

implementation

{ TConexao }

constructor TConexao.Create;
begin
  FConnecta := TConnection.New;
  GetArquivoCfg;
  FConnect := FConnecta.Connection;
end;

destructor TConexao.Destroy;
begin

  inherited;
end;

procedure TConexao.GetArquivoCfg;
var
  lArquivo : TIniFile;
begin
  lArquivo := TIniFile.Create(ExtractFilePath(Application.ExeName) + 'config.ini');

  FConnecta.DriveID(lArquivo.ReadString('BANCO','DRIVEID','ODBC'))
           .DataBase(lArquivo.ReadString('BANCO','DATABASE','Farmacia'))
           .UserName(lArquivo.ReadString('BANCO','USERNAME','root'))
           .Password(lArquivo.ReadString('BANCO','PASSWORD','masterkey'))
           .ODBCDriver(lArquivo.ReadString('BANCO','ODBCDRIVER','MySQL ODBC 8.0 ANSI Driver'));
end;

function TConexao.GetConnect: TFDConnection;
begin
  Result := FConnect;
end;

end.
